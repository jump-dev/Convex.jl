<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extended formulations and the DCP ruleset · Convex.jl</title><meta name="title" content="Extended formulations and the DCP ruleset · Convex.jl"/><meta property="og:title" content="Extended formulations and the DCP ruleset · Convex.jl"/><meta property="twitter:title" content="Extended formulations and the DCP ruleset · Convex.jl"/><meta name="description" content="Documentation for Convex.jl."/><meta property="og:description" content="Documentation for Convex.jl."/><meta property="twitter:description" content="Documentation for Convex.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Convex.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox" checked/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../quick_tutorial/">Quick Tutorial</a></li><li class="is-active"><a class="tocitem" href>Extended formulations and the DCP ruleset</a><ul class="internal"><li><a class="tocitem" href="#A-valid-formulation"><span>A valid formulation</span></a></li><li><a class="tocitem" href="#An-invalid-formulation"><span>An invalid formulation</span></a></li></ul></li><li><a class="tocitem" href="../faq/">FAQ</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">General examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/general_examples/DCP_analysis/">DCP analysis</a></li><li><a class="tocitem" href="../../examples/general_examples/basic_usage/">Basic Usage</a></li><li><a class="tocitem" href="../../examples/general_examples/chebyshev_center/">Chebyshev center</a></li><li><a class="tocitem" href="../../examples/general_examples/control/">Control</a></li><li><a class="tocitem" href="../../examples/general_examples/dualization/">Dualization</a></li><li><a class="tocitem" href="../../examples/general_examples/huber_regression/">Huber regression</a></li><li><a class="tocitem" href="../../examples/general_examples/lasso_regression/">Lasso, Ridge and Elastic Net Regressions</a></li><li><a class="tocitem" href="../../examples/general_examples/logistic_regression/">Logistic regression</a></li><li><a class="tocitem" href="../../examples/general_examples/max_entropy/">Entropy Maximization</a></li><li><a class="tocitem" href="../../examples/general_examples/optimal_advertising/">Optimal advertising</a></li><li><a class="tocitem" href="../../examples/general_examples/robust_approx_fitting/">Robust approximate fitting</a></li><li><a class="tocitem" href="../../examples/general_examples/svm/">Support vector machine</a></li><li><a class="tocitem" href="../../examples/general_examples/svm_l1regularization/">SVM with L^1 regularization</a></li><li><a class="tocitem" href="../../examples/general_examples/trade_off_curves/">Regularized least-squares</a></li><li><a class="tocitem" href="../../examples/general_examples/worst_case_analysis/">Worst case risk analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Mixed integer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/mixed_integer/binary_knapsack/">Binary (or 0-1) knapsack problem</a></li><li><a class="tocitem" href="../../examples/mixed_integer/n_queens/">N queens</a></li><li><a class="tocitem" href="../../examples/mixed_integer/section_allocation/">Section Allocation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Optimization with complex variables</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/Fidelity in Quantum Information Theory/">Fidelity in quantum information theory</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/phase_recovery_using_MaxCut/">Phase recovery using MaxCut</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/povm_simulation/">POVM simulation</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/power_flow_optimization/">Power flow optimization</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/quantum_conditional_entropy/">Continuity of the quantum conditional entropy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Portfolio optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/portfolio_optimization/portfolio_optimization/">Portfolio Optimization</a></li><li><a class="tocitem" href="../../examples/portfolio_optimization/portfolio_optimization2/">Portfolio Optimization - Markowitz Efficient Frontier</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Supplemental material</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/supplemental_material/Convex.jl_intro_ISMP2015/">Convex Optimization in Julia</a></li><li><a class="tocitem" href="../../examples/supplemental_material/paper_examples/">Paper examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Time series</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/time_series/time_series/">Time Series Analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Tomography</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tomography/tomography/">Tomography</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/types/">Basic Types</a></li><li><a class="tocitem" href="../../manual/operations/">Supported Operations</a></li><li><a class="tocitem" href="../../manual/complex-domain_optimization/">Complex-domain Optimization</a></li><li><a class="tocitem" href="../../manual/solvers/">Solvers</a></li><li><a class="tocitem" href="../../manual/performance_tips/">Performance tips</a></li><li><a class="tocitem" href="../../manual/advanced/">Advanced Features</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../developer/problem_depot/">Problem Depot</a></li><li><a class="tocitem" href="../../developer/contributing/">Contributing</a></li><li><a class="tocitem" href="../../developer/credits/">Credits</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/api/">API</a></li><li><a class="tocitem" href="../../reference/atoms/">Supported operations</a></li></ul></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Introduction</a></li><li class="is-active"><a href>Extended formulations and the DCP ruleset</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extended formulations and the DCP ruleset</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jump-dev/Convex.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jump-dev/Convex.jl/blob/master/docs/src/introduction/dcp.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Extended-formulations-and-the-DCP-ruleset"><a class="docs-heading-anchor" href="#Extended-formulations-and-the-DCP-ruleset">Extended formulations and the DCP ruleset</a><a id="Extended-formulations-and-the-DCP-ruleset-1"></a><a class="docs-heading-anchor-permalink" href="#Extended-formulations-and-the-DCP-ruleset" title="Permalink"></a></h1><p>Convex.jl works by transforming the problem (which possibly has nonsmooth, nonlinear constructions like the nuclear norm, the log determinant, and so forth—into) a linear optimization problem subject to conic constraints.</p><p>The transformed problem often involves adding auxiliary variables, and it is called an &quot;extended formulation,&quot; since the original problem has been extended with additional variables.</p><p>Creating an extended formulation relies on the problem being modeled by combining Convex.jl&#39;s &quot;atoms&quot; or primitives according to certain rules which ensure convexity, called the <a href="http://cvxr.com/cvx/doc/dcp.html">disciplined convex programming (DCP) ruleset</a>. If these atoms are combined in a way that does not ensure convexity, the extended formulations are often invalid.</p><h2 id="A-valid-formulation"><a class="docs-heading-anchor" href="#A-valid-formulation">A valid formulation</a><a id="A-valid-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#A-valid-formulation" title="Permalink"></a></h2><p>As a simple example, consider the problem:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Convex, SCS</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model_min = minimize(abs(x), [x &gt;= 1, x &lt;= 2]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; solve!(model_min, SCS.Optimizer; silent = true)</code><code class="nohighlight hljs ansi" style="display:block;">Problem statistics
  problem is DCP         : true
  number of variables    : 1 (1 scalar elements)
  number of constraints  : 2 (2 scalar elements)
  number of coefficients : 2
  number of atoms        : 3

Solution summary
  termination status : OPTIMAL
  primal status      : FEASIBLE_POINT
  dual status        : FEASIBLE_POINT
  objective value    : 1.0

Expression graph
  minimize
   └─ abs (convex; positive)
      └─ real variable (id: 117…069)
  subject to
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 117…069)
   │     └─ [-1;;]
   └─ ≤ constraint (affine)
      └─ + (affine; real)
         ├─ real variable (id: 117…069)
         └─ [-2;;]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x.value</code><code class="nohighlight hljs ansi" style="display:block;">0.999999999998428</code></pre><p>The optimum occurs at <code>x = 1</code>, but let us imagine we want to solve this problem via Convex.jl using a linear programming (LP) solver.</p><p>Since <code>abs</code> is a nonlinear function, we need to reformulate the problem to pass it to the LP solver. We do this by introducing an auxiliary variable <code>t</code> and instead solving:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Convex, SCS</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; t = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model_min_extended = minimize(t, [x &gt;= 1, x &lt;= 2, t &gt;= x, t &gt;= -x]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; solve!(model_min_extended, SCS.Optimizer; silent = true)</code><code class="nohighlight hljs ansi" style="display:block;">Problem statistics
  problem is DCP         : true
  number of variables    : 2 (2 scalar elements)
  number of constraints  : 4 (4 scalar elements)
  number of coefficients : 2
  number of atoms        : 7

Solution summary
  termination status : OPTIMAL
  primal status      : FEASIBLE_POINT
  dual status        : FEASIBLE_POINT
  objective value    : 1.0

Expression graph
  minimize
   └─ real variable (id: 474…890)
  subject to
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 275…758)
   │     └─ [-1;;]
   ├─ ≤ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 275…758)
   │     └─ [-2;;]
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 474…890)
   │     └─ Convex.NegateAtom (affine; real)
   │        └─ …
   ⋮</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x.value</code><code class="nohighlight hljs ansi" style="display:block;">0.999999999998428</code></pre><p>That is, we add the constraints <code>t &gt;= x</code> and <code>t &gt;= -x</code>, and replace <code>abs(x)</code> by <code>t</code>. Since we are minimizing over <code>t</code> and the smallest possible <code>t</code> satisfying these constraints is the absolute value of <code>x</code>, we get the right answer. This reformulation worked because we were minimizing <code>abs(x)</code>, and that is a valid way to use the primitive <code>abs</code>.</p><h2 id="An-invalid-formulation"><a class="docs-heading-anchor" href="#An-invalid-formulation">An invalid formulation</a><a id="An-invalid-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#An-invalid-formulation" title="Permalink"></a></h2><p>The reformulation of <code>abx(x)</code> works only if we are minimizing <code>t</code>.</p><p>Why? Well, let us consider the same reformulation for a maximization problem. The original problem is:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Convex</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model_max = maximize(abs(x), [x &gt;= 1, x &lt;= 2])</code><code class="nohighlight hljs ansi" style="display:block;">Problem statistics
  problem is DCP         : false
  number of variables    : 1 (1 scalar elements)
  number of constraints  : 2 (2 scalar elements)
  number of coefficients : 2
  number of atoms        : 3

Solution summary
  termination status : OPTIMIZE_NOT_CALLED
  primal status      : NO_SOLUTION
  dual status        : NO_SOLUTION

Expression graph
  maximize
   └─ abs (convex; positive)
      └─ real variable (id: 905…144)
  subject to
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 905…144)
   │     └─ [-1;;]
   └─ ≤ constraint (affine)
      └─ + (affine; real)
         ├─ real variable (id: 905…144)
         └─ [-2;;]</code></pre><p>This time, <code>problem is DCP</code> reports <code>false</code>. If we attempt to solve the problem, an error is thrown:</p><pre><code class="language-julia hljs">julia&gt; solve!(model_max, SCS.Optimizer; silent = true)
┌ Warning: Problem not DCP compliant: objective is not DCP
└ @ Convex ~/.julia/dev/Convex/src/problems.jl:73
ERROR: DCPViolationError: Expression not DCP compliant. This either means that your problem is not convex, or that we could not prove it was convex using the rules of disciplined convex programming. For a list of supported operations, see https://jump.dev/Convex.jl/stable/operations/. For help writing your problem as a disciplined convex program, please post a reproducible example on https://jump.dev/forum.
Stacktrace:
[...]</code></pre><p>The error is thrown because, if we do the same reformulation as before, we arrive at the problem:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Convex, SCS</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; t = Variable();</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model_max_extended = maximize(t, [x &gt;= 1, x &lt;= 2, t &gt;= x, t &gt;= -x]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; solve!(model_max_extended, SCS.Optimizer; silent = true)</code><code class="nohighlight hljs ansi" style="display:block;">Problem statistics
  problem is DCP         : true
  number of variables    : 2 (2 scalar elements)
  number of constraints  : 4 (4 scalar elements)
  number of coefficients : 2
  number of atoms        : 7

Solution summary
  termination status : DUAL_INFEASIBLE
  primal status      : INFEASIBILITY_CERTIFICATE
  dual status        : INFEASIBLE_POINT

Expression graph
  maximize
   └─ real variable (id: 285…153)
  subject to
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 737…354)
   │     └─ [-1;;]
   ├─ ≤ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 737…354)
   │     └─ [-2;;]
   ├─ ≥ constraint (affine)
   │  └─ + (affine; real)
   │     ├─ real variable (id: 285…153)
   │     └─ Convex.NegateAtom (affine; real)
   │        └─ …
   ⋮</code></pre><p>whose solution is unbounded.</p><p>In other words, we can get the wrong answer by using the extended reformulation, because the extended formulation was only valid for a minimization problem.</p><p>Convex.jl always creates the extended reformulation, but because they are only guaranteed to be valid when the DCP ruleset is followed, Convex.jl will programmatically check the whether or not these DCP rules were satisfied and error if they were not.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quick_tutorial/">« Quick Tutorial</a><a class="docs-footer-nextpage" href="../faq/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 18 June 2024 07:18">Tuesday 18 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
