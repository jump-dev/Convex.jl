<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance tips · Convex.jl</title><meta name="title" content="Performance tips · Convex.jl"/><meta property="og:title" content="Performance tips · Convex.jl"/><meta property="twitter:title" content="Performance tips · Convex.jl"/><meta name="description" content="Documentation for Convex.jl."/><meta property="og:description" content="Documentation for Convex.jl."/><meta property="twitter:description" content="Documentation for Convex.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Convex.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../introduction/installation/">Installation</a></li><li><a class="tocitem" href="../../introduction/quick_tutorial/">Quick Tutorial</a></li><li><a class="tocitem" href="../../introduction/dcp/">Extended formulations and the DCP ruleset</a></li><li><a class="tocitem" href="../../introduction/faq/">FAQ</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">General examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/general_examples/DCP_analysis/">DCP analysis</a></li><li><a class="tocitem" href="../../examples/general_examples/basic_usage/">Basic Usage</a></li><li><a class="tocitem" href="../../examples/general_examples/chebyshev_center/">Chebyshev center</a></li><li><a class="tocitem" href="../../examples/general_examples/control/">Control</a></li><li><a class="tocitem" href="../../examples/general_examples/dualization/">Dualization</a></li><li><a class="tocitem" href="../../examples/general_examples/huber_regression/">Huber regression</a></li><li><a class="tocitem" href="../../examples/general_examples/lasso_regression/">Lasso, Ridge and Elastic Net Regressions</a></li><li><a class="tocitem" href="../../examples/general_examples/logistic_regression/">Logistic regression</a></li><li><a class="tocitem" href="../../examples/general_examples/max_entropy/">Entropy Maximization</a></li><li><a class="tocitem" href="../../examples/general_examples/optimal_advertising/">Optimal advertising</a></li><li><a class="tocitem" href="../../examples/general_examples/robust_approx_fitting/">Robust approximate fitting</a></li><li><a class="tocitem" href="../../examples/general_examples/svm/">Support vector machine</a></li><li><a class="tocitem" href="../../examples/general_examples/svm_l1regularization/">SVM with L^1 regularization</a></li><li><a class="tocitem" href="../../examples/general_examples/trade_off_curves/">Regularized least-squares</a></li><li><a class="tocitem" href="../../examples/general_examples/worst_case_analysis/">Worst case risk analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Mixed integer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/mixed_integer/binary_knapsack/">Binary (or 0-1) knapsack problem</a></li><li><a class="tocitem" href="../../examples/mixed_integer/n_queens/">N queens</a></li><li><a class="tocitem" href="../../examples/mixed_integer/section_allocation/">Section Allocation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Optimization with complex variables</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/Fidelity in Quantum Information Theory/">Fidelity in quantum information theory</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/phase_recovery_using_MaxCut/">Phase recovery using MaxCut</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/povm_simulation/">POVM simulation</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/power_flow_optimization/">Power flow optimization</a></li><li><a class="tocitem" href="../../examples/optimization_with_complex_variables/quantum_conditional_entropy/">Continuity of the quantum conditional entropy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Portfolio optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/portfolio_optimization/portfolio_optimization/">Portfolio Optimization</a></li><li><a class="tocitem" href="../../examples/portfolio_optimization/portfolio_optimization2/">Portfolio Optimization - Markowitz Efficient Frontier</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Supplemental material</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/supplemental_material/Convex.jl_intro_ISMP2015/">Convex Optimization in Julia</a></li><li><a class="tocitem" href="../../examples/supplemental_material/paper_examples/">Paper examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Time series</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/time_series/time_series/">Time Series Analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Tomography</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tomography/tomography/">Tomography</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../types/">Basic Types</a></li><li><a class="tocitem" href="../operations/">Supported Operations</a></li><li><a class="tocitem" href="../complex-domain_optimization/">Complex-domain Optimization</a></li><li><a class="tocitem" href="../solvers/">Solvers</a></li><li class="is-active"><a class="tocitem" href>Performance tips</a><ul class="internal"><li><a class="tocitem" href="#Faster-problem-formulation:-Avoid-scalar-indexing"><span>Faster problem formulation: Avoid scalar indexing</span></a></li><li><a class="tocitem" href="#Speeding-up-solve-times:-dualization"><span>Speeding up solve times: dualization</span></a></li><li><a class="tocitem" href="#Speeding-up-solve-times:-digging-into-the-final-formulation"><span>Speeding up solve times: digging into the final formulation</span></a></li></ul></li><li><a class="tocitem" href="../advanced/">Advanced Features</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../developer/problem_depot/">Problem Depot</a></li><li><a class="tocitem" href="../../developer/contributing/">Contributing</a></li><li><a class="tocitem" href="../../developer/credits/">Credits</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/api/">API</a></li><li><a class="tocitem" href="../../reference/atoms/">Supported operations</a></li></ul></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Performance tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance tips</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jump-dev/Convex.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jump-dev/Convex.jl/blob/master/docs/src/manual/performance_tips.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-tips"><a class="docs-heading-anchor" href="#Performance-tips">Performance tips</a><a id="Performance-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-tips" title="Permalink"></a></h1><p>There are three phases of building and solving a Convex.jl problem:</p><ol><li>Building the expression tree. This is everything that happens before <code>solve!</code> is called, for example, creating variables, problems, constraints, and other expressions.</li><li>Formulating the problem in MathOptInterface. This happens automatically when <code>solve!</code> is called, and (as long as <code>solve!</code> is not called with <code>silent=true</code>) emits a log message when completed, containing the amount of time it took and the total amount of memory allocations.</li><li>Solving the problem. This happens in <code>solve!</code> after the problem is formulated. When <code>silent=false</code>, typically solvers will print information about the problem and their progress when solving it.</li></ol><p>If you are experiencing performance issues, it is important to isolate which of these three steps is taking the most time. Typically, step (1) should be the fastest, then step (2), then step (3).</p><ul><li>If building the expression tree (step 1 above) is the slowest part, there is likely a performance bug in Convex.jl. Please <a href="https://github.com/jump-dev/Convex.jl/issues/new">file an issue</a> with a reproducible minimal example; it may be able to be quickly fixed.</li><li>If formulating the problem is much slower than solving it, there may be a performance issue in Convex.jl. See <a href="#Faster-problem-formulation:-Avoid-scalar-indexing">Faster problem formulation: Avoid scalar indexing</a> below for one tip to speed things up.</li><li>If solving the problem is the slowest part, you may still be able to improve performance. See <a href="#Speeding-up-solve-times:-dualization">Speeding up solve times: dualization</a> and <a href="#Speeding-up-solve-times:-digging-into-the-final-formulation">Speeding up solve times: digging into the final formulation</a> below. Also consider trying other solvers. For large problems, first-order solvers like SCS and COSMO may be faster (albeit with higher convergence tolerances) than second-order solvers like <a href="https://github.com/oxfordcontrol/Clarabel.jl"><code>Clarabel</code></a> and <a href="https://github.com/jump-dev/Hypatia.jl"><code>Hypatia</code></a>.</li></ul><p>If you&#39;re struggling to improve performance, feel free to ask for help in the <a href="https://jump.dev/forum">community forum</a>. Before asking a question, make sure to read the post <a href="https://discourse.julialang.org/t/psa-make-it-easier-to-help-you/14757">make it easier to help you</a>, which contains a number of tips on how to ask a good question.</p><h2 id="Faster-problem-formulation:-Avoid-scalar-indexing"><a class="docs-heading-anchor" href="#Faster-problem-formulation:-Avoid-scalar-indexing">Faster problem formulation: Avoid scalar indexing</a><a id="Faster-problem-formulation:-Avoid-scalar-indexing-1"></a><a class="docs-heading-anchor-permalink" href="#Faster-problem-formulation:-Avoid-scalar-indexing" title="Permalink"></a></h2><p>When manipulating Convex.jl expressions, try to use a &quot;vectorized&quot; style, and avoid loops and scalar indexing. For example:</p><pre><code class="language-julia hljs">function bad_my_dot(x, y) # avoid this kind of code for Convex.jl expressions!
    s = 0.0
    for i in eachindex(x, y)
        s += x[i]*y[i]
    end
    return s
end</code></pre><p>is usually perfectly reasonable Julia code (although perhaps <code>s</code> should be initialized as <code>s=zero(promote_type(eltype(x), eltype(y))))</code> to be more generic), since loops are typically fast in Julia.</p><p>However, when using Convex.jl expressions like <code>x = Variable(100)</code>, calling <code>bad_my_dot(x, y)</code> with <code>y = rand(100)</code> will create 100 separate <code>IndexAtom</code>s, each of which has some overhead. That is because Convex maintains a lazy expression tree representing the problem. Instead, the vectorized form <code>sum(x .* y)</code> or <code>LinearAlgebra.dot(x, y)</code> will be more efficient.</p><p>Indexing style typically should have no effect on solve times (step (3) above), only on constructing the expression tree and formulating the problem.</p><h2 id="Speeding-up-solve-times:-dualization"><a class="docs-heading-anchor" href="#Speeding-up-solve-times:-dualization">Speeding up solve times: dualization</a><a id="Speeding-up-solve-times:-dualization-1"></a><a class="docs-heading-anchor-permalink" href="#Speeding-up-solve-times:-dualization" title="Permalink"></a></h2><p>Depending on the solver and the problem, it can sometimes speed things up quite a lot to pass the solver the dual problem to solve rather than the primal problem. This can be accomplished easily with <a href="https://github.com/jump-dev/Dualization.jl">Dualization.jl</a>, simply by passing <code>dual_optimizer(optimizer)</code> instead of <code>optimizer</code> to <code>solve!</code>. See <a href="../../examples/general_examples/dualization/#Dualization">Dualization</a> for an example.</p><h2 id="Speeding-up-solve-times:-digging-into-the-final-formulation"><a class="docs-heading-anchor" href="#Speeding-up-solve-times:-digging-into-the-final-formulation">Speeding up solve times: digging into the final formulation</a><a id="Speeding-up-solve-times:-digging-into-the-final-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Speeding-up-solve-times:-digging-into-the-final-formulation" title="Permalink"></a></h2><p>Convex.jl is built around conic programming, and it works with conic solvers. This may be a different optimization methodology than you may be used to, and it works by formulating problems in terms of affine objective functions and affine-function-in-cone constraints for a variety of convex cones. Convex.jl reformulates all problems to this form. For example, the objective function you give Convex will not actually be executed line-by-line; instead, it will be reformulated to a possibly very-different looking form for the conic solver to handle.</p><p>Convex.jl provides an abstraction by automatically performing these reformulations, but as often is the case, performance leaks through. To have the best performance, you might need to learn more details about the various cones supported by your solver, by <a href="https://jump.dev/MathOptInterface.jl/stable/reference/standard_form/#Vector-sets">MathOptInterface</a>, and how Convex.jl reformulates your problem. There could be mathematically equivalent formulations that are faster, and in some cases it could be that Convex&#39;s automatic reformulations can be improved.</p><p>One option to view the final problem after these reformulations is to write it to disk with <a href="../../reference/api/#Convex.write_to_file"><code>Convex.write_to_file</code></a> and inspect it manually or with other software.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../solvers/">« Solvers</a><a class="docs-footer-nextpage" href="../advanced/">Advanced Features »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Friday 21 June 2024 23:58">Friday 21 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
